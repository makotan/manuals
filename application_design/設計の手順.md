# 設計の手順
色々ある表現手法を全て無視した状態で、実際にどうやれば設計が出来るのかについて  
プログラムを設計するときにはさらに詳細化をしたり、プログラムに落とし込む為の作業は必要  
ここに書く内容はその前段階で抜け漏れが無く作る手順  

# 必要な物
必要な物を集めるのが最初の準備作業
- 要求の内容をなるべく詳細に集める
- 外部システムとのやりとりが要求レベルにある場合、その情報を集める
- 改修作業などで既に実装がある場合、ソースコードor設計書で信頼出来る物を集める
- 要求について確認出来る人(それを要望した人なら尚良い)

## 要求の内容をなるべく詳細に集める
要求がしっかりドキュメントされているときはだいぶラッキー  
ドキュメント化されていない場合は自分でドキュメントに起こす  
全てのスタートはここから始まるのでここで最小限のドキュメントがあることが重要  
最小限の内容は**第三者が読んでざっとやりたいことが判る事**  
この段階で機能のリストがあるとか、まともなDB設計がある場合は参考資料として集めておく  

## 外部システムとのやりとりが要求レベルにある場合、その情報を集める
外部システムを使用する前提の開発の場合には多いので、この段階で情報を集めておく  
公開されているシステムならアクセスする為の認証情報はこの段階で手配する  
限定している場合はそのアクセス方法も早めに確認して開発時・テスト時などにアクセス出来るように手配をすること  
その他、外部システムとのインタフェースとかAPIとか情報の有無を確認する  
情報が明らかに不足している場合は提供依頼を出しておく  

## 改修作業などで既に実装がある場合、ソースコードor設計書で信頼出来る物を集める
全くの新規システムなら必要ないけど、既に存在して居るプログラムへの改修作業の場合はなるべく正確な情報を集める  
設計書は信頼出来ないことが良くあるので、ソースコードや検証環境へのアクセスを調査のために早めに許可して貰う  
DB等の情報はドキュメントが正しいのかを確認しておく  
ドキュメントが皆無で質問出来る相手も居ない場合、そのプロジェクトから離れられないか検討する  

## 要求について確認出来る人(それを要望した人なら尚良い)
要求について質問する相手を確保する  
要求の又聞きは回避するのが鉄則なので、要求を出した人に確認出来れば良い  
ただし、要求を出した人が実務担当者でない場合はある程度又聞きになる事もある  
又聞きになってしまう場合、質問内容を正確に伝えるためにメールやチャット等の文章で質問する  

# 要求を確認する
要求の内容を一字一句しっかり読みつつ以下を洗い出す  

- 名詞
- 動詞
- 式

## 名詞
名詞はデータモデルのキーワードになりやすいのでしっかり洗い出す  
改修作業でDBに既にある場合は同様のデータが存在して居るか確認する(そのまま使えるかまでは確認しない)  

## 動詞
名詞とセットの動詞を中心に洗い出す  
要求内容に出てくる動詞は非常に重要な機能を表していることが多い  
ただし、この時点では不足している状態だという認識を持っておく  

## 式
式の具体的内容が明記されている場合はしっかりメモする  
具体的内容が無い場合は後ほど具体化する  
時々外部サービスやライブラリが提供していることもある  

# 機能を洗い出す
ここまで集めた情報から設計対象の機能を洗い出す  

- 名詞＋動詞のセット
- 名詞に対するのCRUDL(作成、読込、更新、削除、リスト)

# DB用のデータモデルを仮で設計する
DBのテーブルとその関連を中心にざっくり設計する  
この段階ではまだ仮で良いので名詞のデータ構造と明記されてる構造を中心にする  

## 名詞＋動詞のセットの周辺に書かれている状態を見つけ出す  
要求の内容に戻って、名詞＋動詞のセットの周辺に書かれている**状態**を探し出す  
状態と動詞から軽く状態遷移図を書いてみる  
状態遷移図で無理があるところ、検討が必要な物を探して必要に応じて質問する  
この作業をすると見えてこなかった新たな機能が必要になったりするので追加していく  
**名詞(データモデル候補)＋状態遷移図＋動詞(機能候補)＋新たな機能**が出来る

### 状態遷移図を確認する
要求通りに状態遷移図を作ると状態遷移図が複雑になり過ぎる可能性がある  
この場合、モデルを分割するか状態そのものを複数化出来ないか検討する  
一つのモデルの一つの状態遷移図に10個を超える状態がある場合は分割を検討する  

# データモデルを詳細化する
インタフェースを設計しつつ、各種データモデルを詳細に検討する  
既に実装が存在している場合はインタフェースやDB設計を解析しつつ行う(ただし、既に存在する実装を前提にしないこと)  
インタフェースの設計をしていくと、ここまでに出てこなかったDBのデータモデルが追加されたりする  
それぞれについてもCRUDLや状態遷移図が必要になる事もある  
結果的に新たな機能が追加になって機能の洗い出しに戻ったりする  

# ここまでに出来るもの
- 機能(CURDL含む)
- 機能毎の入力・出力のデータモデル
- 内部のデータモデルと状態遷移図

**この3種類のドキュメントはしっかり管理すること！**

# 外部システムとのインタフェースを設計する
機能毎に外部システムとのやりとりを検討していく  
外部システムに手を出せない場合は機能の設計からやり直しになることもある  
この段階で管理用の内部のデータモデルが追加されたり、機能が追加になることもある  
作るドキュメントは**マッピング情報**

# 既にデータモデルがある場合
既に存在するDBの構造を洗い出して状態遷移図を作成する  
新たに設計したDBとのマッピングを行う  
かなり変わる場合はデータ移行を伴う更新になるので要求した人や管理者へ事前に伝える  
ちょっとした修正で済む場合はなるべく既存のDBに寄せる  

## 既存のDBに寄せる場合
寄せる場合、状態遷移が大きく異なる事もしっかり考慮する必要がある  
古いプログラムを廃棄して新たしくする場合は、実質的にデータ移行を行う場合が多いので要求した人や管理者へ事前に伝える  
古いプログラムの改修の場合は、既存の状態遷移を扱える様に実装を修正するか、状態を書き換える作業を実施する  

# DB設計する
DB設計する場合は、各種ルールに必須の項目の有無を確認して忘れないように付与する  
PKかサロゲートキーとして単一項目でユニークになるような項目を必ず付与しておく(後工程が楽になるので)  
あとは既に詳細化したデータモデルとプロジェクトのルールにしたがって淡々と正規化してDB設計する  
状態については状態遷移図一つに一つの文字列の項目を作ってそこで状態を管理する  
状態管理用のライブラリを使用している場合はライブラリが管理出来るような情報を付与する  
作るドキュメントは**DB設計書とER図**  

# 機能を設計する
単一の機能で単一の状態を扱う場合、比較的簡単な設計になる  
ある機能が扱うデータ、そのデータの状態をしっかり洗い出す  
変換のルールと必要な外部サービスの呼び出しのルールを決める  
エラー時の挙動は共通に収まるのかを確認して、収まらない場合どうするのかを決める  
その他の共通の挙動として定義されている物を確認。共通の挙動で必要な物を入れる  
作るドキュメントは**機能設計書**  
この設計書は設計内容によって凄く簡単な場合もある  
機能を設計しているとDB設計の不備が見つかったり、状態遷移図の不備が見つかったりするので、その場合は戻る  


# 出来上がるドキュメント

- 第三者が読んでざっとやりたいことが判る要求内容
- 機能(CURDL含む)
- 機能毎の入力・出力のデータモデル
- 内部のデータモデルと状態遷移図
- マッピング情報
- DB設計書とER図
- 機能設計書



