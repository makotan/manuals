# ログについての色々
実装の善し悪しと同様に大事なログについて  
通常のアプリケーションは実装期間に比べると運用時間の方が長い  
運用こそがアプリケーションの価値を生み出す部分  
安心して運用するにはログが必須  
設計や実装は語る人が多いけど、重要なのにログを語る人が少ないので・・・  

# まとめ
- ログレベルはしっかり考えて設定すること
- INFOだけでどんな処理が行われたのか判断出来ること
- 何かの異常があれば必ずWARNレベル以上のログを出力すること
- ログは何があっても死守すること
- ディスク容量には注意！
- `************` みたいなマーキングをしたままコミットしない
- プログラミングする人は一回保守・運用も経験した方が良いと思う

# ログの種類とログレベル

|ログの種類                                           |ログレベル     |
|---------------------------------------------------|--------------|
|アプリケーションの設定などを起動時に出力する              |CONFIG/INFO   |
|システムが動作出来ないような状態になった場合に出力する      |FATAL/ERROR   |
|アプリケーションの想定外の動きによってユーザに異常を伝える時 |ERROR         |
|回復する可能性がある想定外の動きを検出したとき             |WARN          |
|アプリケーションの動作についての情報を出力するとき         |INFO          |
|結合テスト等のテストで必要なログを出力するとき             |DEBUG         |
|プログラムの挙動を確認するためのログを出力するとき         |TRACE         |

CONFIGとかFATALをサポートしてないloggerもあるのでその場合は代わりの物を使う

## ERRORとWARNについて
ユーザの間違えた操作による`エラー`は普通の事なので、INFO/DEBUGレベルで処理する  
ERROR/WARNはあくまでシステム的なトラブル発生を出力するもの  

ERROR/WARNの出力タイミングはプログラムがエラーを検出した**直後に必ず**行うこと  
上位のレベルやフレームワークで上手く処理できる場合でも必ずWARNでの出力は行う  

## INFOについて
かならずこの2回は出力すること
- ユーザのアクションや動作のきっかけの部分
- 終了したタイミング

きっかけの所は最低限のパラメータ(個人情報は無しで)と一緒に出力する  
終了したタイミングでは終了のステータス(成功か失敗か)と処理にかかった時間を出力する  
この辺りはWebベースのフレームワークならフィルターを使用すると良い  
外部呼び出しをする前後にも必ず出力する(外部呼び出しが多すぎなければ)  

## DEBUGについて
基本的にプログラマに全て任されているので、適切に出力する  
テスト等でエラーが起きたときに検証出来る最小限の情報を出力すること  
外部呼び出しが非常に多い場合で且つ安定している物はDEBUGとして出力する  
何処まで進んだとか割と細かく出力すると良い

## TRACEについて
全面的にプログラマに任されているので、適切に出力する  
TRACEは分岐/繰り返し/呼び出しの前後の全てに詳細なデータと共に仕掛けるのもあり  
ただし、出力が多すぎるとCPUを余計に使うのでloggerの設定で適切に抑止する  

# ログを死守する
ログが無いとプログラムで何が起きたのかが判断出来ないので、必ずログは仕組みで死守すること  
ログを失うよくあるパターン
- ディスクフル
- ログの収集ツールが暴走
- ファイル名が一致しない(多重起動の時にtimestamp付きのファイル名になるloggerがある)
- ログローテーションに失敗
- ログの転送先が死亡
- サーバにログインして操作したときに消去

いずれも仕組みでカバーする事が大事  
*担当者が気をつける* は**NG**

# 処理IDをログに付与する
ユーザのアクションや動作のきっかけ毎に処理IDを付与して、それをその処理中のログ全てに付与する  
エラーがあった場合はそのエラーの処理IDを辿れば特定の処理のログを抽出することが出来る  
外部呼び出しの結果、処理IDが返ってくる場合はそれも必ずログに出力すること

# ログに記述する内容
5w1hを基準にログを構成する  
基本的なloggerの設定でかなりカバー出来てるのでそれ以外の所をしっかり出力する  

# ディスク容量について
クラウド環境などでログをディスクに出力する場合、ディスク容量が少ないと適切なパフォーマンスが出ずにサーバの処理が遅延することもある  
たいていの場合、ディスク容量を増やすことで解消するので本番や検証環境などではディスク容量はあまりケチらずに設定すること  

# マーキングログについて
大量に出てるログを探しやすくするために`************`みたいな文字列を入れないこと  
この場合、不要なログを抑える(テスト対象外のTRACE/DEBUGを抑える。そもそも減らす方向に見直す)のが大事
ただし、実装中の場合は何をしても問題ないのでコミット前に忘れないように  

# ログのコンソールへの直接出力について
`print`文などを使ってコンソールへ**ログ**を出力するのは全面的に禁止  
あくまでloggerの設定を使用してコンソールへ出力すること  
ログの保存が不要なテストなどでは特に問題ないので適切に使用する(多用しないこと)  

